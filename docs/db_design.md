# 数据库设计文档

本文件描述了 Demo App 使用的 SQLite 数据库模式，包括各表的结构、字段类型、主键、外键和索引的设计，主要用于管理作品、集字、字帖、标签及应用配置。

---

## 1. 数据库总体结构

采用 SQLite 作为本地存储解决方案，主要包括以下表：

- works
- characters
- practices
- tags
- settings

各表之间通过外键建立关联：

- 一个作品 (works) 可对应多个集字 (characters)
- 一个集字 (characters) 可多次被字帖 (practices) 使用（通过引用使用记录）
- 标签 (tags) 与作品、字帖等关联（可选、扩展字段）

---

## 2. 表设计

### 2.1 表：works

用于存储书法作品的元数据及多图信息

| 字段名称         | 类型        | 描述                                  |
|------------------|-------------|---------------------------------------|
| id               | TEXT (PK)  | 作品唯一标识（UUID）                  |
| name             | TEXT        | 作品名称（必填，1-50字符）            |
| author           | TEXT        | 作者                                  |
| style            | TEXT        | 书法风格                              |
| tool             | TEXT        | 书写工具                              |
| creationDate     | DATETIME    | 创作时间                              |
| metadata         | TEXT        | JSON文本，包含创建时间、修改时间、备注等|

另外，多图信息存储在文件系统中（路径存于 metadata JSON 或单独配置），图像分为：

- original: 原图信息
- imported: 导入后处理图片信息
- thumbnail: 缩略图信息

### 2.2 表：characters

用于存储从作品中提取的集字信息

| 字段名称         | 类型         | 描述                                               |
|------------------|--------------|----------------------------------------------------|
| id               | TEXT (PK)   | 集字唯一标识（UUID）                                |
| workId           | TEXT         | 外键，关联到 works.id                             |
| simplified       | TEXT         | 简体字（必填，必须为单个汉字）                      |
| traditional      | TEXT         | 繁体字（可选）                                     |
| style            | TEXT         | 书法风格（可继承或覆盖作品风格）                    |
| tool             | TEXT         | 书写工具（可继承或覆盖作品工具）                    |
| sourceRegion     | TEXT         | JSON对象，包含 index, x, y, width, height          |
| image            | TEXT         | JSON对象，包含处理后图片路径、缩略图路径及尺寸信息    |
| metadata         | TEXT         | JSON文本，包含创建、修改时间及备注                  |

### 2.3 表：practices

用于存储字帖的数据

| 字段名称         | 类型         | 描述                                              |
|------------------|--------------|---------------------------------------------------|
| id               | TEXT (PK)   | 字帖唯一标识（UUID）                               |
| title            | TEXT         | 字帖标题（必填，1-100字符）                        |
| status           | TEXT         | 字帖状态（例如："draft" 或 "completed"）          |
| pages            | TEXT         | JSON数组，描述各页面内容（不涉及多页模板，只有一页，多层结构存储） |
| metadata         | TEXT         | JSON文本，包含创建、修改时间、打印次数、描述等      |

字帖的页面 JSON 存储结构说明：

- 每个页面（只包含一页）含有多个图层（layers）
- 图层内包含多个元素，每个元素包含 type、几何位置、内容（chars/text/image）等信息，
- 当 type 为 chars 时，content 是一个 JSON 数组，每项描述“charId”、相对坐标、变换和样式

### 2.4 表：tags

用于存储标签信息（扩展功能）

| 字段名称 | 类型        | 描述                                 |
|----------|-------------|--------------------------------------|
| id       | TEXT (PK) | 标签唯一标识                           |
| name     | TEXT       | 标签名称                               |

标签可用于对作品、字帖等进行归类管理，可存储在各表的 metadata 字段中作为引用。

### 2.5 表：settings

用于存储应用配置（单条记录或键值对表）

| 字段名称 | 类型        | 描述                                  |
|----------|-------------|---------------------------------------|
| key      | TEXT (PK)  | 设置项标识                            |
| value    | TEXT       | JSON文本或纯文本的配置信息             |

---

## 3. 数据库关系与索引设计

### 3.1 关系

- **作品与集字**：一对多，works.id → characters.workId
- **集字与字帖**：多对多关系，字帖中通过 JSON 数组引用集字 id
- **标签关联**：标签通过 metadata 的 JSON 数组进行关联

### 3.2 索引设计

为提高查询效率建议在以下字段上建立索引：

- works 表：id (主键)，name，author，creationDate
- characters 表：id (主键)，workId, simplified
- practices 表：id (主键)，title，status
- settings 表：key

---

## 4. 数据验证与业务约束

- 作品名称必须在 1-50 个字符之间
- 集字的 simplified 字段必须为单个汉字
- 字帖标题必须在 1-100 个字符之间
- 外键约束：确保 characters.workId 在 works 表中存在
- 删除作品时，需删除关联的集字记录（级联或应用逻辑处理）

---

## 5. 性能与维护考虑

- 图片数据仅存储路径、尺寸和格式，实际图片存储于文件系统，数据库中仅保存元数据以减小数据库体积
- 利用 JSON 字段灵活存储各模块扩展信息，但需注意解析性能
- 使用定期清理策略管理临时文件和缓存数据
- 根据查询频率建立合理的二级索引，优化查询

---

该数据库设计方案确保数据结构清晰、扩展性良好，并为后续兼容云存储及多平台部署奠定基础。
