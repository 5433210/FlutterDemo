# 画布功能重构影响分析索引

## 概述

本文档从功能视角分析Canvas重构对现有画布操作的影响，包括元素操作和画布操作两大类别。
由于内容丰富，分析被拆分为多个文档，本索引提供完整的导航与内容概览。

## 文档结构

### [第一部分：元素基本操作与组合操作](./07_canvas_operations_impact.md)

1. **元素基本操作**
   - 新增元素
   - 复制元素
   - 粘贴元素
   - 删除元素

2. **元素组合操作**
   - 组合元素
   - 解组合

3. **选择操作** (部分)
   - 框选元素
   - 全选

### [第二部分：选择操作与元素控制](./07_canvas_operations_impact_part2.md)

3. **选择操作** (续)
   - 取消选择
   - 追加选择
   - 反向选择

4. **元素控制（控制点）**
   - 平移元素
   - 旋转元素
   - 缩放元素

### [第三部分：层级操作与辅助功能](./07_canvas_operations_impact_part3.md)

5. **层级操作**
   - 上移元素
   - 下移元素
   - 移到最顶层
   - 移到最底层

6. **辅助功能**
   - 网格显示/隐藏
   - 网格贴附开启/关闭
   - 格式刷复制
   - 格式刷应用

### [第四部分：画布操作与迁移计划](./07_canvas_operations_impact_part4.md)

7. **画布操作**
   - 画布归位（位置重置）
   - 画布平移
   - 画布缩放

8. **功能迁移清单与实施计划**
   - 代码修改分类
   - 迁移实施计划
   - 迁移难点与解决方案

## 核心影响概览

### 架构转变

重构后，所有操作将采用**命令模式**实现，以支持撤销/重做功能。数据模型转为**不可变模式**，通过`copyWith`方法创建新实例而非直接修改。

### 代码调整方式

1. **修改**：所有直接修改状态的操作改为通过命令模式实现
2. **删除**：直接操作集合、状态和UI更新的代码
3. **新增**：各类命令实现、状态管理器和专用服务
4. **保留**：核心算法逻辑、计算函数和业务规则

### 主要新增组件

| 组件类型 | 示例 |
|---------|------|
| 命令类 | `AddElementCommand`, `DeleteElementCommand`, `MoveElementsCommand` |
| 状态管理器 | `ElementState`, `SelectionState`, `ViewportState`, `GridState` |
| 交互工具 | `ElementDragTool`, `RotationHandleTool`, `CanvasPanTool` |
| 专用服务 | `FormatPainterService`, `ClipboardService`, `HitTestManager` |

## 实施策略要点

1. 分阶段迁移，优先核心功能
2. 确保命令系统的状态一致性
3. 注重性能优化，特别是高频操作
4. 维护良好的用户体验和操作响应性
5. 全面的测试覆盖，验证功能等价性

详细的实施计划和迁移步骤请参见[第四部分文档](./07_canvas_operations_impact_part4.md)。
