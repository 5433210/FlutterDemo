# åŒ¹é…æ¨¡å¼ Segments åŒæ­¥é—®é¢˜ä¿®å¤å®ŒæˆæŠ¥å‘Š

## é—®é¢˜è¯Šæ–­

ä»ç”¨æˆ·æä¾›çš„æˆªå›¾å’Œæ—¥å¿—åˆ†æå‘ç°ï¼š

### ğŸ” é—®é¢˜ç°è±¡
- **UIæ˜¾ç¤º**: "Word Matching Priority" æŒ‰é’®æ˜¾ç¤ºä¸ºæ¿€æ´»çŠ¶æ€ï¼ˆè“è‰²ï¼‰
- **æ—¥å¿—æ˜¾ç¤º**: `wordMatchingMode: false`
- **å®é™…è¡Œä¸º**: é¢„è§ˆé¢æ¿æ˜¾ç¤ºå­—ç¬¦åˆ†æ®µè€Œéè¯åˆ†æ®µ
- **æœŸæœ›è¡Œä¸º**: æ¿€æ´»è¯åŒ¹é…æ¨¡å¼æ—¶åº”æ˜¾ç¤º `["nature", " ", "ç§‹"]` åˆ†æ®µ

### ğŸ¯ æ ¹æœ¬åŸå› 
**UIçŠ¶æ€ä¸æ•°æ®çŠ¶æ€ä¸åŒæ­¥ï¼**

1. `M3CollectionPropertyPanel` çš„å†…éƒ¨çŠ¶æ€ `_matchingMode` æ­£ç¡®
2. ä½† `element['content']['wordMatchingPriority']` æ•°æ®æ²¡æœ‰åŒæ­¥æ›´æ–°
3. `M3CharacterPreviewPanel` ä» `content['wordMatchingPriority']` è¯»å–çŠ¶æ€
4. å¯¼è‡´é¢„è§ˆé¢æ¿ä½¿ç”¨é”™è¯¯çš„åŒ¹é…æ¨¡å¼å’Œ segments æ•°æ®

## ä¿®å¤æ–¹æ¡ˆ

### âœ… 1. æ–°å¢ `_initializeMatchingModeAndSegments()` æ–¹æ³•

```dart
/// åˆå§‹åŒ–åŒ¹é…æ¨¡å¼å’Œ segments
void _initializeMatchingModeAndSegments() {
  // æ£€æŸ¥å¹¶è®¾ç½® wordMatchingPriority
  // ç”Ÿæˆå¯¹åº”çš„ segments æ•°æ®
  // ç¡®ä¿å†…éƒ¨çŠ¶æ€ä¸ content æ•°æ®ä¸€è‡´
}
```

**åŠŸèƒ½**:
- åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–åŒ¹é…æ¨¡å¼
- ç¡®ä¿ `content` ä¸­åŒ…å«æ­£ç¡®çš„ `wordMatchingPriority` å±æ€§
- æ ¹æ®åŒ¹é…æ¨¡å¼ç”Ÿæˆå¯¹åº”çš„ `segments` æ•°æ®

### âœ… 2. å¢å¼º `_onWordMatchingModeChanged()` æ–¹æ³•

```dart
/// åˆ‡æ¢åŒ¹é…æ¨¡å¼
void _onWordMatchingModeChanged(bool isWordMatching) {
  // æ›´æ–°å†…éƒ¨çŠ¶æ€
  setState(() { _matchingMode = ... });
  
  // åŒæ­¥æ›´æ–° content æ•°æ®
  content['wordMatchingPriority'] = isWordMatching;
  content['segments'] = _generateSegments(characters, isWordMatching);
  
  // è§¦å‘ UI é‡å»º
  _updateProperty('content', content);
}
```

**åŠŸèƒ½**:
- åˆ‡æ¢åŒ¹é…æ¨¡å¼æ—¶åŒæ­¥æ›´æ–° `content` æ•°æ®
- é‡æ–°ç”Ÿæˆå¯¹åº”æ¨¡å¼çš„ `segments`
- ç¡®ä¿æ‰€æœ‰ä¾èµ–ç»„ä»¶è·å¾—æœ€æ–°æ•°æ®

### âœ… 3. æ–°å¢ `_generateSegments()` æ–¹æ³•

```dart
/// æ ¹æ®åŒ¹é…æ¨¡å¼ç”Ÿæˆ segments
List<Map<String, dynamic>> _generateSegments(String text, bool wordMatching) {
  if (wordMatching) {
    // è¯åŒ¹é…ï¼šæŒ‰ç©ºæ ¼åˆ†è¯
    // "nature ç§‹" â†’ ["nature", " ", "ç§‹"]
  } else {
    // å­—ç¬¦åŒ¹é…ï¼šé€å­—ç¬¦åˆ†æ®µ
    // "nature ç§‹" â†’ ["n","a","t","u","r","e"," ","ç§‹"]
  }
}
```

**åŠŸèƒ½**:
- è¯åŒ¹é…æ¨¡å¼ï¼šæ™ºèƒ½åˆ†è¯ï¼ˆæŒ‰ç©ºæ ¼åˆ†å‰²ï¼‰
- å­—ç¬¦åŒ¹é…æ¨¡å¼ï¼šé€å­—ç¬¦åˆ†æ®µ
- ç”Ÿæˆæ ‡å‡†çš„ segments æ•°æ®ç»“æ„

## ä¿®å¤æ•ˆæœ

### ğŸ¯ è¯åŒ¹é…æ¨¡å¼ (wordMatchingPriority: true)
```
è¾“å…¥: "nature ç§‹"
segments: [
  {text: "nature", startIndex: 0, length: 6},
  {text: " ", startIndex: 6, length: 1}, 
  {text: "ç§‹", startIndex: 7, length: 1}
]
é¢„è§ˆ: æ˜¾ç¤º 3 ä¸ªæ®µçš„é›†å­—
å€™é€‰: æœç´¢ "nature" çš„å®Œæ•´è¯åŒ¹é…
```

### ğŸ¯ å­—ç¬¦åŒ¹é…æ¨¡å¼ (wordMatchingPriority: false)
```
è¾“å…¥: "nature ç§‹"
segments: [
  {text: "n", startIndex: 0, length: 1},
  {text: "a", startIndex: 1, length: 1},
  {text: "t", startIndex: 2, length: 1},
  {text: "u", startIndex: 3, length: 1},
  {text: "r", startIndex: 4, length: 1},
  {text: "e", startIndex: 5, length: 1},
  {text: " ", startIndex: 6, length: 1},
  {text: "ç§‹", startIndex: 7, length: 1}
]
é¢„è§ˆ: æ˜¾ç¤º 8 ä¸ªå•å­—ç¬¦é›†å­—
å€™é€‰: åˆ†åˆ«æœç´¢ "n", "a", "t", "u", "r", "e", "ç§‹" çš„ç²¾ç¡®åŒ¹é…
```

## æŠ€æœ¯æ”¹è¿›

### ğŸ”§ æ•°æ®ä¸€è‡´æ€§ä¿éšœ
- å†…éƒ¨çŠ¶æ€ `_matchingMode` ä¸ `content['wordMatchingPriority']` å§‹ç»ˆåŒæ­¥
- segments æ•°æ®ä¸åŒ¹é…æ¨¡å¼å®Œå…¨å¯¹åº”
- æ‰€æœ‰ UI ç»„ä»¶ä½¿ç”¨ç›¸åŒçš„æ•°æ®æº

### ğŸ”§ è°ƒè¯•æ—¥å¿—å¢å¼º
- è¯¦ç»†è®°å½•åŒ¹é…æ¨¡å¼åˆ‡æ¢è¿‡ç¨‹
- è¾“å‡º segments ç”Ÿæˆçš„å®Œæ•´æ•°æ®
- ä¾¿äºé—®é¢˜å®šä½å’ŒéªŒè¯

### ğŸ”§ åˆå§‹åŒ–å®Œå–„
- åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥å’Œåˆå§‹åŒ–æ•°æ®
- å¤„ç†å†å²æ•°æ®çš„å…¼å®¹æ€§
- ç¡®ä¿æ–°è€ç‰ˆæœ¬æ•°æ®ç»“æ„ä¸€è‡´

## éªŒè¯æ­¥éª¤

### ğŸ“‹ ç”¨æˆ·æµ‹è¯•æ¸…å•

1. **é‡æ–°å¯åŠ¨åº”ç”¨**
   - ç¡®ä¿åˆå§‹åŒ–é€»è¾‘ç”Ÿæ•ˆ

2. **è¾“å…¥æµ‹è¯•æ–‡æœ¬**
   - è¾“å…¥: `"nature ç§‹"`

3. **éªŒè¯è¯åŒ¹é…æ¨¡å¼**
   - âœ… "Word Matching Priority" æŒ‰é’®ä¸ºæ¿€æ´»çŠ¶æ€
   - âœ… é¢„è§ˆé¢æ¿æ˜¾ç¤º 3 ä¸ªæ®µ: [nature] [ç©ºæ ¼] [ç§‹]
   - âœ… é€‰ä¸­ "nature" ä¸­ä»»æ„å­—ç¬¦æ—¶å€™é€‰æ˜¾ç¤ºå®Œæ•´è¯åŒ¹é…

4. **éªŒè¯å­—ç¬¦åŒ¹é…æ¨¡å¼**
   - âœ… ç‚¹å‡»æŒ‰é’®åˆ‡æ¢åˆ°å­—ç¬¦åŒ¹é…æ¨¡å¼
   - âœ… é¢„è§ˆé¢æ¿æ˜¾ç¤º 8 ä¸ªå•å­—ç¬¦æ®µ
   - âœ… é€‰ä¸­æ¯ä¸ªå­—ç¬¦æ—¶å€™é€‰æ˜¾ç¤ºç²¾ç¡®å­—ç¬¦åŒ¹é…

5. **éªŒè¯æ¨¡å¼åˆ‡æ¢**
   - âœ… ä¸¤ç§æ¨¡å¼é—´èƒ½æ­£å¸¸åˆ‡æ¢
   - âœ… åˆ‡æ¢æ—¶ segments æ•°æ®ç«‹å³æ›´æ–°
   - âœ… æ—¥å¿—æ˜¾ç¤ºæ­£ç¡®çš„ `wordMatchingPriority` å€¼

## ç»“è®º

âœ… **é—®é¢˜å·²å½»åº•ä¿®å¤**
- UI çŠ¶æ€ä¸æ•°æ®çŠ¶æ€å®Œå…¨åŒæ­¥
- åŒ¹é…æ¨¡å¼åˆ‡æ¢åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- segments æ•°æ®ä¸é¢„è§ˆé¢æ¿æ˜¾ç¤ºä¸€è‡´
- å€™é€‰å­—ç¬¦æœç´¢é€»è¾‘æ­£ç¡®åŒ¹é…

âœ… **ç³»ç»Ÿå¥å£®æ€§æå‡**
- æ•°æ®ä¸€è‡´æ€§ä¿éšœæœºåˆ¶
- å®Œå–„çš„åˆå§‹åŒ–é€»è¾‘
- è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

ç°åœ¨ç”¨æˆ·åº”è¯¥èƒ½çœ‹åˆ°ä¸ UI æŒ‰é’®çŠ¶æ€å®Œå…¨åŒ¹é…çš„é¢„è§ˆæ•ˆæœï¼
