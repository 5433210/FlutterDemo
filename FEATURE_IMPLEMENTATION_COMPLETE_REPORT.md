# ç­›é€‰é¢æ¿åˆ·æ–°åŠŸèƒ½å’Œä½œå“åˆ é™¤çº§è”åŠŸèƒ½å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ ä»»åŠ¡å®Œæˆæ¦‚è¿°

### âœ… å·²å®Œæˆçš„åŠŸèƒ½
1. **ç­›é€‰é¢æ¿åˆ·æ–°åŠŸèƒ½** - ä¸ºæ‰€æœ‰ç­›é€‰é¢æ¿æ·»åŠ åˆ·æ–°æŒ‰é’®
2. **ä½œå“åˆ é™¤çº§è”åŠŸèƒ½** - åˆ é™¤ä½œå“æ—¶åŒæ—¶åˆ é™¤å…³è”çš„é›†å­—æ•°æ®

## ğŸ”§ ç­›é€‰é¢æ¿åˆ·æ–°åŠŸèƒ½å®ç°

### ä¿®æ”¹çš„ç»„ä»¶æ–‡ä»¶
1. **`lib/presentation/pages/works/components/filter/m3_work_filter_panel.dart`**
   - æ·»åŠ  `onRefresh` å›è°ƒå‚æ•°
   - åœ¨é‡ç½®æŒ‰é’®å·¦ä¾§æ·»åŠ åˆ·æ–°æŒ‰é’®ï¼ˆIcons.syncï¼‰

2. **`lib/presentation/pages/characters/components/m3_character_filter_panel.dart`**
   - æ·»åŠ  `onRefresh` å›è°ƒå‚æ•°
   - åœ¨é‡ç½®æŒ‰é’®å·¦ä¾§æ·»åŠ åˆ·æ–°æŒ‰é’®ï¼ˆIcons.syncï¼‰

3. **`lib/presentation/pages/practices/components/m3_practice_filter_panel.dart`**
   - æ·»åŠ  `onRefresh` å›è°ƒå‚æ•°
   - åœ¨é‡ç½®æŒ‰é’®å·¦ä¾§æ·»åŠ åˆ·æ–°æŒ‰é’®ï¼ˆIcons.syncï¼‰

4. **`lib/presentation/pages/library/components/m3_library_filter_panel.dart`**
   - æ·»åŠ  `onRefresh` å›è°ƒå‚æ•°
   - åœ¨é‡ç½®æŒ‰é’®å·¦ä¾§æ·»åŠ åˆ·æ–°æŒ‰é’®ï¼ˆIcons.syncï¼‰

### ä¿®æ”¹çš„ViewModel/Provideræ–‡ä»¶
1. **`lib/presentation/viewmodels/work_browse_view_model.dart`**
   - æ·»åŠ  `refresh()` æ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨ `loadWorks(forceRefresh: true)`

2. **`lib/presentation/providers/character/character_management_provider.dart`**
   - æ·»åŠ  `refresh()` æ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨ `loadCharacters(forceRefresh: true)`

3. **`lib/presentation/viewmodels/practice_list_view_model.dart`**
   - æ·»åŠ  `refresh()` æ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨ `loadPractices(forceRefresh: true)`

4. **`lib/presentation/providers/library/library_management_provider.dart`**
   - æ·»åŠ  `refresh()` æ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨ `loadData(forceRefresh: true)`

### ä¿®æ”¹çš„é¡µé¢æ–‡ä»¶
1. **`lib/presentation/pages/works/m3_work_browse_page.dart`**
   - åœ¨è°ƒç”¨ç­›é€‰é¢æ¿æ—¶ä¼ å…¥ `onRefresh` å›è°ƒ

2. **`lib/presentation/pages/characters/components/m3_character_browse_panel.dart`**
   - åœ¨è°ƒç”¨ç­›é€‰é¢æ¿æ—¶ä¼ å…¥ `onRefresh` å›è°ƒ

3. **`lib/presentation/pages/practices/m3_practice_list_page.dart`**
   - åœ¨è°ƒç”¨ç­›é€‰é¢æ¿æ—¶ä¼ å…¥ `onRefresh` å›è°ƒ

4. **`lib/presentation/widgets/library/m3_library_browsing_panel.dart`**
   - åœ¨è°ƒç”¨ç­›é€‰é¢æ¿æ—¶ä¼ å…¥ `onRefresh` å›è°ƒ

### æœ¬åœ°åŒ–æ–‡ä»¶
- **`lib/l10n/app_zh.arb`** - æ·»åŠ  `"refresh": "åˆ·æ–°"`
- **`lib/l10n/app_en.arb`** - æ·»åŠ  `"refresh": "Refresh"`

## ğŸ—‘ï¸ ä½œå“åˆ é™¤çº§è”åŠŸèƒ½å®ç°

### æ ¸å¿ƒæœåŠ¡ä¿®æ”¹
1. **`lib/application/services/work/work_service.dart`**
   - æ‰©å±• `deleteWork()` æ–¹æ³•å®ç°çº§è”åˆ é™¤é€»è¾‘ï¼š
     1. æŸ¥æ‰¾ä½œå“çš„æ‰€æœ‰å…³è”é›†å­—æ•°æ®
     2. æ‰¹é‡åˆ é™¤é›†å­—æ•°æ®ï¼ˆæ•°æ®åº“ã€å›¾ç‰‡ã€ç¼“å­˜ï¼‰
     3. åˆ é™¤ä½œå“æ•°æ®åº“è®°å½•
     4. æ¸…ç†ä½œå“å›¾ç‰‡æ–‡ä»¶
   - æ·»åŠ å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†

2. **`lib/application/providers/service_providers.dart`**
   - æ›´æ–° `workServiceProvider` æ·»åŠ  `CharacterService` ä¾èµ–
   - æ·»åŠ å¿…è¦çš„å¯¼å…¥è¯­å¥

### åˆ é™¤æµç¨‹è¯¦è§£
```
ä½œå“åˆ é™¤è¯·æ±‚
    â†“
æŸ¥æ‰¾ä½œå“å…³è”çš„é›†å­—æ•°æ® (CharacterRepository.findByWorkId)
    â†“
æ‰¹é‡åˆ é™¤é›†å­—æ•°æ® (CharacterService.deleteBatchCharacters)
    â”œâ”€â”€ åˆ é™¤é›†å­—æ•°æ®åº“è®°å½•
    â”œâ”€â”€ åˆ é™¤é›†å­—å›¾ç‰‡æ–‡ä»¶
    â””â”€â”€ æ¸…ç†é›†å­—ç¼“å­˜
    â†“
åˆ é™¤ä½œå“æ•°æ®åº“è®°å½• (WorkRepository.delete)
    â†“
æ¸…ç†ä½œå“å›¾ç‰‡æ–‡ä»¶ (WorkImageService.cleanupWorkImages)
    â†“
å®Œæˆåˆ é™¤æ“ä½œ
```

### åˆ©ç”¨çš„ç°æœ‰API
- `CharacterRepository.findByWorkId(String workId)` - æŸ¥æ‰¾ä½œå“å…³è”é›†å­—
- `CharacterService.deleteBatchCharacters(List<String> ids)` - æ‰¹é‡åˆ é™¤é›†å­—
- `WorkImageService.cleanupWorkImages(String workId)` - æ¸…ç†ä½œå“å›¾ç‰‡

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### åˆ·æ–°åŠŸèƒ½ç‰¹ç‚¹
- **ä¸€è‡´çš„UIè®¾è®¡** - æ‰€æœ‰ç­›é€‰é¢æ¿éƒ½åœ¨é‡ç½®æŒ‰é’®å·¦ä¾§æ·»åŠ äº†åŒæ ·çš„åˆ·æ–°æŒ‰é’®
- **å¼ºåˆ¶åˆ·æ–°** - åˆ·æ–°æ—¶è°ƒç”¨ `forceRefresh: true` å‚æ•°ï¼Œç¡®ä¿é‡æ–°åŠ è½½æ•°æ®
- **å¤šè¯­è¨€æ”¯æŒ** - æ”¯æŒä¸­è‹±æ–‡åˆ·æ–°æŒ‰é’®æç¤ºæ–‡æœ¬
- **å“åº”å¼è®¾è®¡** - æŒ‰é’®åœ¨ä¸åŒå±å¹•å¤§å°ä¸‹éƒ½èƒ½æ­£å¸¸æ˜¾ç¤º

### åˆ é™¤çº§è”åŠŸèƒ½ç‰¹ç‚¹
- **å®Œæ•´æ€§ä¿è¯** - åˆ é™¤ä½œå“æ—¶ç¡®ä¿æ‰€æœ‰å…³è”æ•°æ®éƒ½è¢«æ¸…ç†
- **é”™è¯¯å¤„ç†** - å³ä½¿é›†å­—åˆ é™¤å¤±è´¥ï¼Œä½œå“åˆ é™¤ä¹Ÿä¼šç»§ç»­æ‰§è¡Œ
- **è¯¦ç»†æ—¥å¿—** - å®Œæ•´çš„æ“ä½œæ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§
- **æ€§èƒ½ä¼˜åŒ–** - ä½¿ç”¨æ‰¹é‡åˆ é™¤æ¥å£æé«˜åˆ é™¤æ•ˆç‡

## ğŸ§ª ä»£ç è´¨é‡

### åˆ†æç»“æœ
- âœ… é€šè¿‡ `flutter analyze` æ£€æŸ¥
- âœ… æ— é˜»æ–­æ€§é”™è¯¯
- âœ… éµå¾ªFlutteræœ€ä½³å®è·µ
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### æµ‹è¯•è¦†ç›–
- âœ… ç­›é€‰é¢æ¿UIåˆ·æ–°åŠŸèƒ½æµ‹è¯•
- âœ… æ•°æ®åŠ è½½åˆ·æ–°é€»è¾‘æµ‹è¯•
- âœ… ä½œå“åˆ é™¤çº§è”é€»è¾‘æµ‹è¯•

## ğŸš€ ä½¿ç”¨æ–¹å¼

### ç­›é€‰é¢æ¿åˆ·æ–°
ç”¨æˆ·ç‚¹å‡»ç­›é€‰é¢æ¿ä¸­çš„åˆ·æ–°æŒ‰é’®ï¼ˆğŸ”„å›¾æ ‡ï¼‰ï¼Œç³»ç»Ÿä¼šé‡æ–°åŠ è½½å½“å‰é¡µé¢çš„æ•°æ®ï¼Œåº”ç”¨å½“å‰çš„ç­›é€‰æ¡ä»¶ã€‚

### ä½œå“åˆ é™¤
å½“ç”¨æˆ·åˆ é™¤ä½œå“æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. åˆ é™¤è¯¥ä½œå“çš„æ‰€æœ‰é›†å­—æ•°æ®
2. åˆ é™¤é›†å­—ç›¸å…³çš„å›¾ç‰‡æ–‡ä»¶
3. æ¸…ç†é›†å­—ç›¸å…³çš„ç¼“å­˜
4. åˆ é™¤ä½œå“æœ¬èº«åŠå…¶å›¾ç‰‡

## ğŸ“ æ€»ç»“

æœ¬æ¬¡å®ç°å®Œæˆäº†ä¸¤ä¸ªä¸»è¦åŠŸèƒ½ï¼š

1. **ç­›é€‰é¢æ¿åˆ·æ–°åŠŸèƒ½** - ä¸ºä½œå“æµè§ˆã€é›†å­—ç®¡ç†ã€å­—å¸–æµè§ˆã€å›¾åº“ç®¡ç†ç­‰é¡µé¢çš„ç­›é€‰é¢æ¿ç»Ÿä¸€æ·»åŠ äº†åˆ·æ–°æŒ‰é’®ï¼Œæ”¯æŒæ•°æ®é‡æ–°åŠ è½½ã€‚

2. **ä½œå“åˆ é™¤çº§è”åŠŸèƒ½** - æ‰©å±•äº†ä½œå“åˆ é™¤é€»è¾‘ï¼Œç¡®ä¿åˆ é™¤ä½œå“æ—¶åŒæ—¶åˆ é™¤æ‰€æœ‰å…³è”çš„é›†å­—æ•°æ®ã€å›¾ç‰‡æ–‡ä»¶å’Œç¼“å­˜ï¼Œç»´æŠ¤æ•°æ®å®Œæ•´æ€§ã€‚

ä¸¤ä¸ªåŠŸèƒ½éƒ½å·²ç»è¿‡æµ‹è¯•éªŒè¯ï¼Œä»£ç è´¨é‡è‰¯å¥½ï¼Œç¬¦åˆé¡¹ç›®çš„æ¶æ„è®¾è®¡å’Œç¼–ç è§„èŒƒã€‚
