# æ­¥é©Ÿ5è¼¸å‡ºç‰©ï¼šTransformè®Šæ›æ•¸å€¼é©—è­‰

## æ•¸å€¼é©—è­‰ç­–ç•¥

åŸºæ–¼æ­¥é©Ÿ2çš„æ•¸å­¸æ¨¡å‹å’Œæ­¥é©Ÿ4çš„èª¿è©¦æ—¥èªŒï¼Œæˆ‘å€‘éœ€è¦é©—è­‰Transformè®Šæ›çš„å¯¦éš›è¨ˆç®—çµæœæ˜¯å¦èˆ‡ç†è«–é æœŸä¸€è‡´ã€‚

## æ‰‹å·¥æ•¸å­¸é©—è­‰

### æ¸¬è©¦æ¡ˆä¾‹ï¼š750Ã—1667åœ–åƒï¼Œ90åº¦æ—‹è½‰ï¼Œ400Ã—300å®¹å™¨

#### éšæ®µ1ï¼šæœªæ—‹è½‰æ™‚çš„åŸºç¤è¨ˆç®—

```dart
// è¼¸å…¥åƒæ•¸
imageSize = Size(750, 1667)
containerSize = Size(400, 300)
rotationDegrees = 90.0

// æ­¥é©Ÿ1ï¼šè¨ˆç®—renderSize
imageRatio = imageSize.width / imageSize.height 
          = 750 / 1667 
          = 0.4499

containerRatio = containerSize.width / containerSize.height
               = 400 / 300 
               = 1.3333

// å› ç‚º imageRatio < containerRatio (0.4499 < 1.3333)
// æ‰€ä»¥ä»¥å®¹å™¨é«˜åº¦ç‚ºæº–ï¼ˆcontainæ¨¡å¼ï¼‰
renderSize = Size(
  containerSize.height * imageRatio,  // 300 * 0.4499 = 134.97
  containerSize.height                // 300
) = Size(134.97, 300)

// æ­¥é©Ÿ2ï¼šè¨ˆç®—åœ–åƒå±…ä¸­ä½ç½®
imagePosition = Offset(
  (containerSize.width - renderSize.width) / 2,   // (400 - 134.97) / 2 = 132.515
  (containerSize.height - renderSize.height) / 2  // (300 - 300) / 2 = 0
) = Offset(132.515, 0)

// æ­¥é©Ÿ3ï¼šæœªæ—‹è½‰æ™‚çš„åœ–åƒå€åŸŸ
unrotatedImageRect = Rect.fromLTWH(132.515, 0, 134.97, 300)
```

#### éšæ®µ2ï¼šTransformè®Šæ›è¨ˆç®—

```dart
// Transformè®Šæ›åƒæ•¸
centerX = containerSize.width / 2 = 400 / 2 = 200
centerY = containerSize.height / 2 = 300 / 2 = 150
rotationRadians = 90 * (Ï€ / 180) = Ï€/2 = 1.5708

// TransformçŸ©é™£æ“ä½œé †åºï¼š
// 1. translate(200, 150)  - ç§»å‹•åˆ°å®¹å™¨ä¸­å¿ƒ
// 2. rotateZ(Ï€/2)         - é †æ™‚é‡æ—‹è½‰90åº¦
// 3. translate(-200, -150) - ç§»å›åŸä½

// å››å€‹è§’é»è®Šæ›è¨ˆç®—
corners = [
  topLeft:     (132.515, 0),
  topRight:    (267.485, 0),    // 132.515 + 134.97
  bottomRight: (267.485, 300),  // 132.515 + 134.97, 0 + 300
  bottomLeft:  (132.515, 300)   // 132.515, 0 + 300
]

// 90åº¦é †æ™‚é‡æ—‹è½‰è®Šæ›å…¬å¼ï¼š
// å°æ–¼é» (x, y)ï¼Œåœç¹ä¸­å¿ƒ (cx, cy) æ—‹è½‰90åº¦ï¼š
// x' = -(y - cy) + cx
// y' = (x - cx) + cy

transformedCorners = [
  topLeft:     (-(0 - 150) + 200, (132.515 - 200) + 150) = (350, 82.515),
  topRight:    (-(0 - 150) + 200, (267.485 - 200) + 150) = (350, 217.485),
  bottomRight: (-(300 - 150) + 200, (267.485 - 200) + 150) = (50, 217.485),
  bottomLeft:  (-(300 - 150) + 200, (132.515 - 200) + 150) = (50, 82.515)
]

// è¨ˆç®—è®Šæ›å¾Œçš„é‚Šç•Œæ¡†
minX = min(350, 350, 50, 50) = 50
maxX = max(350, 350, 50, 50) = 350
minY = min(82.515, 217.485, 217.485, 82.515) = 82.515
maxY = max(82.515, 217.485, 217.485, 82.515) = 217.485

// æœ€çµ‚è®Šæ›å¾Œçš„é‚Šç•Œæ¡†
transformedBounds = Rect.fromLTRB(50, 82.515, 350, 217.485)
                  = Rect.fromLTWH(50, 82.515, 300, 134.97)
```

#### éšæ®µ3ï¼šè£å‰ªæ¡†è¨ˆç®—é©—è­‰

```dart
// å…¨åœ–è£å‰ªçš„æƒ…æ³
cropParams = (x: 0, y: 0, width: 750, height: 1667)

// è£å‰ªæ¯”ä¾‹
cropRatioX = 0 / 750 = 0
cropRatioY = 0 / 1667 = 0
cropRatioWidth = 750 / 750 = 1.0
cropRatioHeight = 1667 / 1667 = 1.0

// æ­£ç¢ºçš„çµ±ä¸€è¨ˆç®—ï¼ˆæ‡‰è©²åŒ¹é…Transformçµæœï¼‰
correctCropRect = transformedBounds = Rect.fromLTWH(50, 82.515, 300, 134.97)

// ç•¶å‰éŒ¯èª¤çš„è¨ˆç®—ï¼ˆå¿½ç•¥æ—‹è½‰ï¼‰
currentWrongCropRect = Rect.fromLTWH(
  132.515 + (0 * 134.97),  // 132.515
  0 + (0 * 300),           // 0
  1.0 * 134.97,            // 134.97
  1.0 * 300                // 300
) = Rect.fromLTWH(132.515, 0, 134.97, 300)
```

## é æœŸæ—¥èªŒé©—è­‰

æ ¹æ“šæ­¥é©Ÿ4æ·»åŠ çš„èª¿è©¦æ—¥èªŒï¼Œé‹è¡Œæ‡‰ç”¨æ™‚æ‡‰è©²çœ‹åˆ°ä»¥ä¸‹è¼¸å‡ºï¼š

### Transformè®Šæ›æ—¥èªŒ
```
ğŸ” === TransformçŸ©é™£æ§‹å»º ===
  - å®¹å™¨å°ºå¯¸: 400.0Ã—300.0
  - æ—‹è½‰ä¸­å¿ƒ: (200.0, 150.0)
  - æ—‹è½‰è§’åº¦: 90Â° = 1.5708 radians
  - ğŸ“ åŸå§‹åœ–åƒå€åŸŸ: Rect.fromLTWH(132.5, 0.0, 135.0, 300.0)
  - ğŸ”„ è§’é»è®Šæ›è¨ˆç®—:
    - å·¦ä¸Š: (132.5, 0.0) â†’ (350.0, 82.5)
    - å³ä¸Š: (267.5, 0.0) â†’ (350.0, 217.5)
    - å³ä¸‹: (267.5, 300.0) â†’ (50.0, 217.5)
    - å·¦ä¸‹: (132.5, 300.0) â†’ (50.0, 82.5)
  - ğŸ“ è®Šæ›å¾Œé‚Šç•Œæ¡†: Rect.fromLTRB(50.0, 82.5, 350.0, 217.5)
  - ğŸ“ è®Šæ›å¾Œå°ºå¯¸: 300.0Ã—135.0
```

### è£å‰ªæ¡†è¨ˆç®—æ—¥èªŒ
```
ğŸ” === _calculateCropRectForTransformedImage å¼€å§‹ ===
  - containerSize: 400.0Ã—300.0
  - imageSize: 750.0Ã—1667.0
  - renderSize: 134.97Ã—300.0
  - contentRotation: 90Â°
  - âš ï¸ è­¦å‘Šï¼šå½“å‰ç®—æ³•å¿½ç•¥äº†90Â°æ—‹è½¬ï¼
  - ğŸ“ 90åº¦æ—‹è½¬åçš„é¢„æœŸä½ç½®: left=50.0, top=82.5
  - ğŸ“ 90åº¦æ—‹è½¬åçš„é¢„æœŸå°ºå¯¸: 300.0Ã—135.0
  - âœ… æœ€ç»ˆç»“æœï¼ˆå¿½ç•¥æ—‹è½¬çš„é”™è¯¯ç»“æœï¼‰: Rect.fromLTWH(132.5, 0.0, 135.0, 300.0)
  - âŒ é—®é¢˜ï¼šæ­¤ç»“æœæœªè€ƒè™‘æ—‹è½¬ï¼Œä¸å®é™…æ˜¾ç¤ºä¸åŒ¹é…ï¼
```

## æ•¸å€¼åå·®åˆ†æ

### é—œéµå·®ç•°å°æ¯”
```
é …ç›®                     | æ­£ç¢ºå€¼(Transform)        | éŒ¯èª¤å€¼(ç•¶å‰è¨ˆç®—)         | å·®ç•°
------------------------|-------------------------|-------------------------|------------------
å·¦ä¸Šè§’Xåæ¨™              | 50.0                    | 132.515                 | 82.515åƒç´ åç§»
å·¦ä¸Šè§’Yåæ¨™              | 82.515                  | 0.0                     | 82.515åƒç´ åç§»  
å¯¬åº¦                    | 300.0                   | 134.97                  | 165.03åƒç´ å·®ç•°
é«˜åº¦                    | 134.97                  | 300.0                   | 165.03åƒç´ å·®ç•°
ä¸­å¿ƒé»X                 | 200.0                   | 200.0                   | 0ï¼ˆå·§åˆæ­£ç¢ºï¼‰
ä¸­å¿ƒé»Y                 | 150.0                   | 150.0                   | 0ï¼ˆå·§åˆæ­£ç¢ºï¼‰
```

### è¦–è¦ºå½±éŸ¿åˆ†æ
```
éŒ¯èª¤çš„è£å‰ªæ¡†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 400Ã—300å®¹å™¨
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                   â”‚ éŒ¯èª¤ â”‚              â”‚ 134.97Ã—300
â”‚                   â”‚ çš„   â”‚              â”‚ ä½ç½®ï¼š(132.515, 0)
â”‚                   â”‚ è£å‰ª â”‚              â”‚
â”‚                   â”‚ æ¡†   â”‚              â”‚
â”‚                   â”‚      â”‚              â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­£ç¢ºçš„è£å‰ªæ¡†ï¼ˆæ‡‰è©²åŒ¹é…æ—‹è½‰å¾Œçš„åœ–åƒï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 400Ã—300å®¹å™¨
â”‚                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ 300Ã—134.97
â”‚    â”‚        æ­£ç¢ºçš„è£å‰ªæ¡†          â”‚      â”‚ ä½ç½®ï¼š(50, 82.515)
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…¶ä»–è§’åº¦é©—è­‰

### 45åº¦æ—‹è½‰è¨ˆç®—
```dart
// 45åº¦æ—‹è½‰æ›´è¤‡é›œï¼Œéœ€è¦ä½¿ç”¨ä¸‰è§’å‡½æ•¸
rotationRadians = 45 * (Ï€ / 180) = Ï€/4 = 0.7854
cos(Ï€/4) = sin(Ï€/4) = âˆš2/2 â‰ˆ 0.7071

// å°æ–¼åŸå§‹åœ–åƒå€åŸŸ 134.97Ã—300
// æ—‹è½‰å¾Œçš„åŒ…åœç›’å°ºå¯¸è¨ˆç®—ï¼š
newWidth = |134.97 * cos(Ï€/4)| + |300 * sin(Ï€/4)|
         = 134.97 * 0.7071 + 300 * 0.7071
         = 95.44 + 212.13
         = 307.57

newHeight = |134.97 * sin(Ï€/4)| + |300 * cos(Ï€/4)|
          = 134.97 * 0.7071 + 300 * 0.7071  
          = 95.44 + 212.13
          = 307.57

// 45åº¦æ—‹è½‰å¾Œçš„é‚Šç•Œæ¡†å°‡æœƒæ˜¯æ­£æ–¹å½¢ï¼š307.57Ã—307.57
// ä½†é€™æœƒè¶…å‡º300é«˜åº¦çš„å®¹å™¨é™åˆ¶ï¼Œæ‰€ä»¥æœƒè¢«è£å‰ª
```

### 0åº¦æ—‹è½‰é©—è­‰ï¼ˆå›æ­¸æ¸¬è©¦ï¼‰
```dart
// 0åº¦æ—‹è½‰æ‡‰è©²èˆ‡æœªæ—‹è½‰å®Œå…¨ä¸€è‡´
rotationDegrees = 0
transformedBounds = unrotatedImageRect = Rect.fromLTWH(132.515, 0, 134.97, 300)

// é€™ç¨®æƒ…æ³ä¸‹ï¼Œç•¶å‰éŒ¯èª¤çš„ç®—æ³•ç¢°å·§æœƒå¾—åˆ°æ­£ç¢ºçµæœ
// é€™å°±æ˜¯ç‚ºä»€éº¼éæ—‹è½‰åœ–åƒå·¥ä½œæ­£å¸¸çš„åŸå› 
```

## æ¸¬è©¦åŸ·è¡Œè¨ˆåŠƒ

### 1. å¯¦éš›é‹è¡Œé©—è­‰
```
æ­¥é©Ÿï¼š
1. è¼‰å…¥750Ã—1667åœ–åƒ
2. æ—‹è½‰90åº¦  
3. æª¢æŸ¥æ§åˆ¶å°æ—¥èªŒ
4. å°æ¯”å¯¦éš›æ•¸å€¼èˆ‡é æœŸæ•¸å€¼

é æœŸé©—è­‰é»ï¼š
âœ“ renderSize: 134.97Ã—300
âœ“ imagePosition: (132.515, 0)
âœ“ Transformä¸­å¿ƒ: (200, 150)
âœ“ è®Šæ›å¾Œé‚Šç•Œ: (50, 82.515, 300, 134.97)
âœ— ç•¶å‰è£å‰ªæ¡†: (132.515, 0, 134.97, 300) - éŒ¯èª¤
```

### 2. é‚Šç•Œæƒ…æ³æ¸¬è©¦
```
æ¸¬è©¦æ¡ˆä¾‹ï¼š
- 0åº¦ï¼šæ‡‰è©²åŒ¹é…
- 45åº¦ï¼šæ‡‰è©²æœ‰æ˜é¡¯å·®ç•°
- 90åº¦ï¼šæ‡‰è©²å¯¬é«˜äº’æ›
- 180åº¦ï¼šæ‡‰è©²æœ‰180åº¦å°ç¨±
- 270åº¦ï¼šæ‡‰è©²èˆ‡90åº¦ç›¸ä¼¼ä½†æ–¹å‘ç›¸å
```

### 3. ç²¾åº¦é©—è­‰
```
å…è¨±èª¤å·®ç¯„åœï¼š
- ä½ç½®èª¤å·®: < 0.5åƒç´ 
- å°ºå¯¸èª¤å·®: < 0.5åƒç´   
- è§’åº¦ç²¾åº¦: < 0.01åº¦
```

## é©—è­‰çµæœé æœŸ

### æˆåŠŸæ¨™æº–
1. **Transformè¨ˆç®—æ­£ç¢º**ï¼šè§’é»è®Šæ›æ•¸å€¼èˆ‡æ‰‹å·¥è¨ˆç®—ä¸€è‡´
2. **å•é¡Œç¢ºèª**ï¼šç•¶å‰è£å‰ªæ¡†è¨ˆç®—ç¢ºå¯¦å¿½ç•¥æ—‹è½‰
3. **æ•¸å€¼ç²¾ç¢º**ï¼šæ‰€æœ‰é—œéµæ•¸å€¼åœ¨èª¤å·®ç¯„åœå…§
4. **æ—¥èªŒå®Œæ•´**ï¼šèƒ½å¤ è¿½è¹¤å®Œæ•´çš„è¨ˆç®—éç¨‹

### å¤±æ•—æƒ…æ³è™•ç†
å¦‚æœé©—è­‰ç™¼ç¾ï¼š
1. **Transformè¨ˆç®—éŒ¯èª¤**ï¼šéœ€è¦ä¿®æ­£TransformçŸ©é™£æ§‹å»º
2. **æ•¸å€¼ç²¾åº¦å•é¡Œ**ï¼šéœ€è¦èª¿æ•´è¨ˆç®—ç²¾åº¦
3. **é‚Šç•Œæƒ…æ³ç•°å¸¸**ï¼šéœ€è¦æ·»åŠ é‚Šç•Œæª¢æŸ¥

## æ‰‹å·¥è¨ˆç®—è¡¨æ ¼é©—è­‰

### 90åº¦æ—‹è½‰å®Œæ•´è¨ˆç®—è¡¨
| æ­¥é©Ÿ | è¨ˆç®—é …ç›® | å…¬å¼ | è¼¸å…¥å€¼ | è¨ˆç®—éç¨‹ | çµæœ |
|-----|---------|------|-------|---------|------|
| 1 | imageRatio | width/height | 750,1667 | 750/1667 | 0.4499 |
| 2 | containerRatio | width/height | 400,300 | 400/300 | 1.3333 |
| 3 | renderSize.width | heightÃ—ratio | 300,0.4499 | 300Ã—0.4499 | 134.97 |
| 4 | renderSize.height | height | 300 | 300 | 300 |
| 5 | imageLeft | (cW-rW)/2 | 400,134.97 | (400-134.97)/2 | 132.515 |
| 6 | imageTop | (cH-rH)/2 | 300,300 | (300-300)/2 | 0 |
| 7 | æ—‹è½‰ä¸­å¿ƒX | containerW/2 | 400 | 400/2 | 200 |
| 8 | æ—‹è½‰ä¸­å¿ƒY | containerH/2 | 300 | 300/2 | 150 |
| 9 | å·¦ä¸Šè§’è®Šæ›X | -(y-cy)+cx | 0,150,200 | -(0-150)+200 | 350 |
| 10 | å·¦ä¸Šè§’è®Šæ›Y | (x-cx)+cy | 132.515,200,150 | (132.515-200)+150 | 82.515 |
| 11 | è®Šæ›å¾Œleft | min(corners.x) | 350,350,50,50 | min(...) | 50 |
| 12 | è®Šæ›å¾Œtop | min(corners.y) | 82.515,217.485,... | min(...) | 82.515 |
| 13 | è®Šæ›å¾Œwidth | max(x)-min(x) | 350,50 | 350-50 | 300 |
| 14 | è®Šæ›å¾Œheight | max(y)-min(y) | 217.485,82.515 | 217.485-82.515 | 134.97 |

### é©—è­‰æª¢æŸ¥é»
- [ ] renderSizeè¨ˆç®—ï¼š134.97Ã—300 âœ“
- [ ] åœ–åƒä½ç½®ï¼š(132.515, 0) âœ“  
- [ ] æ—‹è½‰ä¸­å¿ƒï¼š(200, 150) âœ“
- [ ] è®Šæ›å¾Œä½ç½®ï¼š(50, 82.515) âœ“
- [ ] è®Šæ›å¾Œå°ºå¯¸ï¼š300Ã—134.97 âœ“
- [ ] ç•¶å‰éŒ¯èª¤çµæœï¼š(132.515, 0, 134.97, 300) âœ“

é€™å€‹è©³ç´°çš„æ•¸å€¼é©—è­‰ç‚ºæ­¥é©Ÿ6çš„çµ±ä¸€ç®—æ³•å¯¦ç¾æä¾›äº†ç²¾ç¢ºçš„ç›®æ¨™å€¼å’Œé©—è­‰æ¨™æº–ã€‚